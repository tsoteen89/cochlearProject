<style>
	.bold {
	
		font-weight: bold;
		
	}
</style>

<div class="container" ng-controller="messagingController" ng-init="selectTab('messages')">
    <div class="col-lg-7">
		<label style="font-size:2vw; color:#4B92AE">Messages</label><br><br>
	</div>
	
	<div class="col-lg-5">
		<div class="input-group custom-search-form">
		   <!-- <pre> Selected Message {{selectedMessage| json}}</pre> -->
		  <input type="text" class="form-control" placeholder="Search Messages" ng-model="search">
		  <span class="input-group-btn">
		  <button class="btn btn-default" type="button">
		  <span class="glyphicon glyphicon-search"></span>
		 </button>
		 </span>
		 </div><!-- /input-group -->
	</div>
	
	<br>
	
	<div class="col-xs-10 button-wrapper" id="PageButtons" style="margin-bottom: 15px" ng-show="userLevelID <= 10">
		<a class="btn btn-primary" ng-class="{ active:isSelectedTab('messages') }" ng-click="selectTab('messages')">Messages</a>
		<a class="btn btn-primary" ng-class="{ active:isSelectedTab('alerts') }" ng-click="selectTab('alerts')">Alerts</a>
		<a class="btn btn-primary" ng-class="{ active:isSelectedTab('notifications') }" ng-click="selectTab('notifications')">Notifications</a>
	</div>
	
  <div class="row">
	
	<!-- *********************   MESSAGES    ************************* -->
	
	<div class="messaging-system" ng-show="isSelectedTab('messages')" ng-controller="messagingController" ng-init="checkForRecipients()">
	
	  <div class="col-xs-10 button-wrapper">
		<button type="button" class="btn btn-default" ng-click="setMessageType('composeMessage')">
		  <span><i class="glyphicon glyphicon-plus"></i></span> New Message
		</button>
	  </div>
	  
	  <div class="col-xs-3">
		<ul class="nav nav-pills nav-stacked">
		  <hr>
		  <li ng-class="{ active:isTypeSelected('inbox') }"><a href ng-click="setMessageType('inbox'); togglePopup(); clearMarkedMessages()"><i class="glyphicon glyphicon-envelope" style="margin-right:5px"></i> Inbox</a></li>
		  <li ng-class="{ active:isTypeSelected('sent') }"><a href ng-click="setMessageType('sent'); togglePopup(); clearMarkedMessages()"><i class="glyphicon glyphicon-send" style="margin-right:5px"></i> Sent</a></li>
		  <li ng-class="{ active:isTypeSelected('drafts') } "><a href ng-click="setMessageType('drafts'); togglePopup(); clearMarkedMessages()"><i class="glyphicon glyphicon-pencil" style="margin-right:5px"></i> Drafts</a></li>
		  <li ng-class="{ active:isTypeSelected('deleted') }"><a href ng-click="setMessageType('deleted'); togglePopup(); clearMarkedMessages()"><i class="glyphicon glyphicon-trash" style="margin-right:5px"></i> Deleted</a></li>
		  <hr>
		</ul>
	  </div>
	
	  <div class="col-xs-7 message-wrapper" ng-show="isTypeSelected('composeMessage')">
		
		<hr>
		<form name="compose_Message">
		  <span style="margin-right:5px">To (Username):</span> <input class="send" type="text" style="width: 75%; margin-bottom: 5px;" ng-required="true" ng-model="composeMessage.ReceiverUsername"> <br>
		  
		  <span style="margin-right:5px">Subject:</span> <input class="subject" type="text" style="width: 75%; margin-bottom: 5px;" ng-required="true" ng-model="composeMessage.Subject"> <br>

		  <span style="margin-right:5px">Message:</span> <textarea rows="10" cols="100" style="margin-bottom: 10px;" ng-required="true" ng-model="composeMessage.Content"></textarea><br>

		  <input class="btn btn-success" type="submit" name="submit" style="margin-right: 5px;" value="Send" ng-click="sendMessage(composeMessage);setMessageType('inbox')"></input>
		  <input class="btn btn-primary" type="submit" name="submit" style="margin-right: 5px;" value="Save as Draft" ng-click="saveDraft(composeMessage);setMessageType('inbox')"></input>
		  <input class="btn btn-primary" type="submit" name="submit" style="margin-right: 5px;" value="Cancel" ng-click="clearComposedMessage();setMessageType('inbox')"></input>
		</form>

		<hr>
	  </div>
	
	  <div class="col-xs-7 message-display" ng-show="displayMessages">
		<div class="messageToolbar"> 
			<span class="col-xs-3" ng-show="showDelete"><button class="btn btn-default" ng-click="putMarkedMessages('deleted',1)"><i class="glyphicon glyphicon-remove" style="margin-right:5px"></i>Delete</button></span>
			<span class="col-xs-3" ng-show="showFullDelete"><button class="btn btn-default" ng-click="putMarkedMessages('deleted',2)"><i class="glyphicon glyphicon-remove" style="margin-right:5px"></i>Delete</button></span>
			<span class="col-xs-3" ng-show="isTypeSelected('inbox')"><button class="btn btn-default" ng-click="putMarkedMessages('read',1)"><i class="glyphicon glyphicon-bookmark" style="margin-right:5px"></i>Mark as Read</button></span>
			<span class="col-xs-3" ng-show="isTypeSelected('inbox')"><button class="btn btn-default" ng-click="putMarkedMessages('read',0)"><i class="glyphicon glyphicon-tag" style="margin-right:5px"></i>Mark as Unread</button></span>
			<span class="col-xs-3"><button class="btn btn-default" ng-click="refreshMessages();clearMarkedMessages()"><i class="glyphicon glyphicon-repeat" style="margin-right:5px"></i>Refresh</button></span>
			<hr></br>
		</div>
		<div class="table-responsive">
		  <table class="table table-striped table-hover">
			<tr style="cursor:pointer">
			  <th style="cursor:default">
				<input type="checkbox" name="inboxCheckbox" onclick="markAllMessages('inbox', this)"> <span><i class="glyphicon glyphicon-chevron-down" style="color:blue"></i></span>
			  </th>
			  <th ng-click="order('SenderName')" ng-if="showFrom">From</th>
			  <th ng-click="order('ReceiverName')" ng-if="showTo">To</th>
			  <th ng-click="order('Subject')" ng-if="showSubject">Subject</th>
			  <th ng-click="order('Timestamp')" ng-if="showTimestamp">Time</th>
			  <th ng-click="order('Timestamp')" ng-if="showTimestamp">Date</th>
			</tr>
			<tr ng-repeat="message in currentMessages.records | filter:search | orderBy:orderFilter:reverse" ng-click="togglePopup(message)" style="cursor:pointer" ng-class="{'bold':(message.IsRead == '0') && isTypeSelected('inbox')}">
			  <td style="cursor:default"><input type="Checkbox" name="inboxCheckbox" checklist-value="message" checklist-model="markedMessages"> </td>
			  <td ng-if="showFrom" >{{message.ShortSenderName}}</td>
			  <td ng-if="showTo">{{message.ShortReceiverName}}</td>
			  <td ng-if="showSubject">{{message.ShortSubject}}</td>
			  <td ng-if="showTimestamp">{{message.Timestamp * 1000 | date:'h:mm a'}}</td>
			  <td ng-if="showTimestamp">{{message.Timestamp * 1000 | date:'M/d/yy'}}</td>
			</tr>
			</table>
		</div>
	   
		  <hr>
		  <div class="modal-dialogue" ng-show="isPopupVisible" style="background:white; border-style:solid; border-width:1px">
			<div class="modal-header">
				<h3>{{selectedMessage.Subject}}</h3>
			</div>
			<div class="modal-body">
				<div ng-if="showFrom"><strong>From:</strong> {{selectedMessage.SenderName}} ({{selectedMessage.SenderUsername}}) </br></div>
				<div ng-if="showTo"><strong>To:</strong> {{selectedMessage.ReceiverName}} ({{selectedMessage.ReceiverUsername}}) </br></div>
				<div ng-if="showTimestamp"><strong>Time:</strong> {{selectedMessage.Timestamp * 1000 | date:'h:mm a'}} </br></div>
				<div ng-if="showTimestamp"><strong>Date:</strong> {{selectedMessage.Timestamp * 1000 | date:'M/d/yy'}} </br></div>
				</br>
				<p>
					{{selectedMessage.Content}}
				</p>
			</div>
			<div class="modal-footer">
				<a class="btn btn-primary" ng-if="showReply" ng-click="setMessageType('composeMessage'); reply()">Reply</a>
				<a class="btn btn-primary" ng-if="showForward" ng-click="setMessageType('composeMessage'); forward()">Forward</a>
				<a class="btn btn-primary" ng-if="showEdit" ng-click="setMessageType('composeMessage'); edit()">Edit</a>
				<a class="btn btn-primary" ng-if="showRestore" ng-click="restoreSelectedMessage()">Restore</a>
				<a class="btn btn-primary" ng-if="showDelete" ng-click="deleteSelectedMessage()">Delete</a>
				<a class="btn btn-primary" ng-if="showFullDelete" ng-click="fullyDeleteSelectedMessage()">Delete</a>
				<a class="btn btn-primary" ng-click="togglePopup()">Close</a>
			</div>
		  </div>
	  </div>
	</div>
	
	<!-- *********************   ALERTS    ************************* -->
	
	<div class="alertSystem" ng-show="isSelectedTab('alerts')" ng-controller="alertsController" ng-init="setAlertType('received')">
	  
	  <div class="col-xs-3">
		<ul class="nav nav-pills nav-stacked">
		  <hr>
		  <li ng-class="{ active:isTypeSelected('received') }"><a href ng-click="setAlertType('received'); hidePopup(); clearMarkedAlerts()"><i class="glyphicon glyphicon-envelope" style="margin-right:5px"></i> Received</a></li>
		  <li ng-class="{ active:isTypeSelected('deleted') }"><a href ng-click="setAlertType('deleted'); hidePopup(); clearMarkedAlerts()"><i class="glyphicon glyphicon-trash" style="margin-right:5px"></i> Deleted</a></li>
		  <hr>
		</ul>
	  </div>
	
	  <div class="col-xs-7 message-display">
		<div class="messageToolbar"> 
			<span class="col-xs-3" ng-show="showDelete"><button class="btn btn-default" ng-click="putMarkedAlerts('deleted',1)"><i class="glyphicon glyphicon-remove" style="margin-right:5px"></i>Delete</button></span>
			<span class="col-xs-3" ng-show="showFullDelete"><button class="btn btn-default" ng-click="putMarkedAlerts('deleted',2)"><i class="glyphicon glyphicon-remove" style="margin-right:5px"></i>Delete</button></span>
			<span class="col-xs-3" ng-show="isTypeSelected('received')"><button class="btn btn-default" ng-click="putMarkedAlerts('read',1)"><i class="glyphicon glyphicon-bookmark" style="margin-right:5px"></i>Mark as Read</button></span>
			<span class="col-xs-3" ng-show="isTypeSelected('received')"><button class="btn btn-default" ng-click="putMarkedAlerts('read',0)"><i class="glyphicon glyphicon-tag" style="margin-right:5px"></i>Mark as Unread</button></span>
			<span class="col-xs-3"><button class="btn btn-default" ng-click="refreshAlerts();clearMarkedAlerts()"><i class="glyphicon glyphicon-repeat" style="margin-right:5px"></i>Refresh</button></span>
			<hr></br>
		</div>
		<div class="table-responsive">
		  <table class="table table-striped table-hover">
			<tr style="cursor:pointer">
			  <th style="cursor:default">
				<input type="checkbox" name="controlCheckbox" onclick="markAllAlerts(this)"> <a href=""><span><i class="glyphicon glyphicon-chevron-down"></i></span>
				</a>
			  </th>
			  <th ng-click="order('SenderFacilityName')" ng-if="showFrom">Patient</th>
			  <th ng-click="order('Subject')" ng-if="showSubject">Subject</th>
			  <th ng-click="order('Timestamp')" ng-if="showTimestamp">Time</th>
			  <th ng-click="order('Timestamp')" ng-if="showTimestamp">Date</th>
			</tr>
			<tr ng-repeat="alert in currentAlerts.records | filter:search | orderBy:orderFilter:reverse" ng-click="togglePopup(alert)" style="cursor:pointer" ng-class="{'bold':alert.IsRead == '0' && isTypeSelected('received')}">
			  <td style="cursor:default"><input type="Checkbox" name="alertCheckbox" checklist-value="alert" checklist-model="markedAlerts"> </td>
			  <td ng-if="showFrom">{{alert.ShortPatient}}</td>
			  <td ng-if="showSubject">{{alert.ShortSubject}}</td>
			  <td ng-if="showTimestamp">{{alert.Timestamp * 1000 | date:'h:mm a'}}</td>
			  <td ng-if="showTimestamp">{{alert.Timestamp * 1000 | date:'M/d/yy'}}</td>
			</tr>
			</table>
		</div>
	   
		  <hr>
		  <div class="modal-dialogue" ng-show="showPopup" style="background:white; border-style:solid; border-width:1px">
			<div class="modal-header">
				<h3>{{selectedAlert.Subject}}</h3>
			</div>
			<div class="modal-body">
				<div><strong>Patient:</strong> {{selectedAlert.Patient}} </br></div>
				<div><strong>Patient DOB:</strong> {{selectedAlert.PatientDOB}} </br></div>
				<div><strong>Time:</strong> {{selectedAlert.Timestamp * 1000 | date:'h:mm a'}} </br></div>
				<div><strong>Date:</strong> {{selectedAlert.Timestamp * 1000 | date:'M/d/yy'}} </br></div>
				</br>
				<p>
					{{selectedAlert.Content}}
				</p>
			</div>
			<div class="modal-footer">
				<a class="btn btn-primary" ng-if="showRestore" ng-click="deleteSelectedAlert(0); hidePopup()">Restore</a>
				<a class="btn btn-primary" ng-if="showDelete" ng-click="deleteSelectedAlert(1); hidePopup()">Delete</a>
				<a class="btn btn-primary" ng-if="showFullDelete" ng-click="deleteSelectedAlert(2); hidePopup()">Delete</a>
				<a class="btn btn-primary" ng-click="togglePopup()">Close</a>
			</div>
		  </div>
	  </div>
	</div>
	
	<!-- *********************   NOTIFICATIONS    ************************* -->
	
	<div class="notificationSystem" ng-show="isSelectedTab('notifications')" ng-controller="notificationsController" ng-init="setNotificationType('received')">
	  
	  <div class="col-xs-3">
		<ul class="nav nav-pills nav-stacked">
		  <hr>
		  <li ng-class="{ active:isTypeSelected('received') }"><a href ng-click="setNotificationType('received'); hidePopup(); clearMarkedMessages()"><i class="glyphicon glyphicon-envelope" style="margin-right:5px"></i> Received</a></li>
		  <li ng-class="{ active:isTypeSelected('deleted') }"><a href ng-click="setNotificationType('deleted'); hidePopup(); clearMarkedMessages()"><i class="glyphicon glyphicon-trash" style="margin-right:5px"></i> Deleted</a></li>
		  <hr>
		</ul>
	  </div>
	
	  <div class="col-xs-7 message-display">
		<div class="messageToolbar"> 
			<span class="col-xs-3" ng-show="showDelete"><button class="btn btn-default" ng-click="putMarkedNotifications('deleted',1)"><i class="glyphicon glyphicon-remove" style="margin-right:5px"></i>Delete</button></span>
			<span class="col-xs-3" ng-show="showFullDelete"><button class="btn btn-default" ng-click="putMarkedNotifications('deleted',2)"><i class="glyphicon glyphicon-remove" style="margin-right:5px"></i>Delete</button></span>
			<span class="col-xs-3" ng-show="isTypeSelected('received')"><button class="btn btn-default" ng-click="putMarkedNotifications('read',1)"><i class="glyphicon glyphicon-bookmark" style="margin-right:5px"></i>Mark as Read</button></span>
			<span class="col-xs-3" ng-show="isTypeSelected('received')"><button class="btn btn-default" ng-click="putMarkedNotifications('read',0)"><i class="glyphicon glyphicon-tag" style="margin-right:5px"></i>Mark as Unread</button></span>
			<span class="col-xs-3"><button class="btn btn-default" ng-click="refreshNotifications();clearMarkedNotifications()"><i class="glyphicon glyphicon-repeat" style="margin-right:5px"></i>Refresh</button></span>
			<hr></br>
		</div>
		<div class="table-responsive">
		  <table class="table table-striped table-hover">
			<tr style="cursor:pointer">
			  <th style="cursor:default">
				<input type="checkbox" name="controlCheckbox" onclick="markAllNotifications(this)"> <a href=""><span><i class="glyphicon glyphicon-chevron-down"></i></span>
				</a>
			  </th>
			  <th ng-click="order('SenderFacilityName')" ng-if="showFrom">From</th>
			  <th ng-click="order('Subject')" ng-if="showSubject">Subject</th>
			  <th ng-click="order('Timestamp')" ng-if="showTimestamp">Time</th>
			  <th ng-click="order('Timestamp')" ng-if="showTimestamp">Date</th>
			</tr>
			<tr ng-repeat="notification in currentNotifications.records | filter:search | orderBy:orderFilter:reverse" ng-click="togglePopup(notification)" style="cursor:pointer" ng-class="{'bold':notification.IsRead == '0' && isTypeSelected('received')}">
			  <td style="cursor:default"><input type="Checkbox" name="notificationCheckbox" checklist-value="notification" checklist-model="markedNotifications"> </td>
			  <td ng-if="showFrom">{{notification.ShortSenderFacilityName}}</td>
			  <td ng-if="showSubject">{{notification.ShortSubject}}</td>
			  <td ng-if="showTimestamp">{{notification.Timestamp * 1000 | date:'h:mm a'}}</td>
			  <td ng-if="showTimestamp">{{notification.Timestamp * 1000 | date:'M/d/yy'}}</td>
			</tr>
			</table>
		</div>
	   
		  <hr>
		  <div class="modal-dialogue" ng-show="showPopup" style="background:white; border-style:solid; border-width:1px">
			<div class="modal-header">
				<h3>{{selectedNotification.Subject}}</h3>
			</div>
			<div class="modal-body">
				<div><strong>From:</strong> {{selectedNotification.SenderFacilityName}} </br></div>
				<div><strong>Patient:</strong> {{selectedNotification.Patient}} </br></div>
				<div><strong>Patient DOB:</strong> {{selectedNotification.PatientDOB}} </br></div>
				<div><strong>Time:</strong> {{selectedNotification.Timestamp * 1000 | date:'h:mm a'}} </br></div>
				<div><strong>Date:</strong> {{selectedNotification.Timestamp * 1000 | date:'M/d/yy'}} </br></div>
				</br>
				<p>
					{{selectedNotification.Content}}
				</p>
			</div>
			<div class="modal-footer">
				<a class="btn btn-success" ng-show="isTypeSelected('received')" ng-if="selectedNotification.IsRequest" ng-click="respondToRequest(1); hidePopup()">Accept</a>
				<a class="btn btn-danger" ng-show="isTypeSelected('received')" ng-if="selectedNotification.IsRequest" ng-click="respondToRequest(2); hidePopup()">Reject</a>
				<a class="btn btn-primary" ng-if="showRestore" ng-click="deleteSelectedNotification(0); hidePopup()">Restore</a>
				<a class="btn btn-primary" ng-if="showDelete" ng-click="deleteSelectedNotification(1); hidePopup()">Delete</a>
				<a class="btn btn-primary" ng-if="showFullDelete" ng-click="deleteSelectedNotification(2); hidePopup()">Delete</a>
				<a class="btn btn-primary" ng-click="togglePopup()">Close</a>
			</div>
		  </div>
	  </div>
	</div>
	
  </div>
</div>