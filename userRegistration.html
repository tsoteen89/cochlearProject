<html ng-app="userRegApp" style="width:100%;height:100%;">
   <head>
      <title>AII User Registration</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link href="css/facReg.css" rel="stylesheet">
   </head>
    <body >
        <div ng-controller="regCtrl" class="container-fluid">
      <!-- Header -->
      <div style="background-color: white; box-shadow: 0 2px 10px -1px gray; width:100%; height:8%">
         <a class="navbar-brand" style="color: black" href="#">Auditory Implant Initiative</a>
        </div>
            <nav class = "navbar navbar-default navbar-fixed-top" role = "navigation">
            <div class = "container-fluid">
                <div class = "navbar-header">
                    <a class="navbar-brand cp_navbar-brand" href="#">Auditory Implant Initiative</a>
                </div>
                <div class = "nav-items collapse navbar-collapse pull-right" id = "nav-responsive-collapse">
                <a href = "./" class="navbar-btn pull-right"><button type="button" class="btn btn-default">Sign in</button></a>
              </div>
            </div>
            </nav>
      <br>
        
        <!--Stolen form -------------------->
        <form id="msform">
            <!-- fieldset -->
            <fieldset>
                <h3 class="fs-title">Register as a new user</h3>
                <div class="row">
                    <div class="col-md-5"><input type="text" name="first" placeholder="First Name" ng-model="registration.first_name"/> </div>
                    <div class="col-md-5" ><input type="text" name="last" placeholder="Last Name" ng-model="registration.last_name"/> </div>
                    <div class="col-md-2" ><select id="titles" name="title" ng-options="title.TitleID as title.Abbreviation for title in userTitles" ng-model="registration.TitleID">  </select></div>
                </div>
                <input type="text" name="username" placeholder="Username" ng-model="registration.username"/>
                <input type="password" name="password" placeholder="Password" ng-model="registration.password"/>
                
                <input type="text" name="email" placeholder="Email" ng-model="registration.email"/>
                <input type="text" name="phone" placeholder="Phone Number" ng-model="registration.phone"/>
                
               <!-- {{registration}}-->
                <input type="submit" name="submit" class="submit action-button" value="Submit" ng-click="registerUser()"/> <br>(not yet functionally ready)
            </fieldset>
            
        </form>
            </div>
    </body>
    <!-- All Dependencies Here -->
  
<script src="js/angular.js"></script>
<script src="js/angular-route.js"></script>
<script src="js/checklist-model.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.10.0/ui-bootstrap.js"></script>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.11.0.js"></script>
<script src="js/jquery.min.js"></script>
<!-- jQuery easing plugin -->
<script src="js/jquery.easing.min.js" type="text/javascript"></script>
<script src="js/registration.js" type="text/javascript"></script>

<script>
   var userRegApp = angular.module('userRegApp', ['ui.bootstrap','checklist-model'] ); 
   
   var controllers = {};
   
   controllers.regCtrl =  function($scope, $http, getData) {
       
       //need to grab facility id,-handle with api
       $scope.registration = {};
       getData.get('http://killzombieswith.us/aii-api/v1/userTitles').success(function(data){
           $scope.userTitles = data.records;
       }); 
       $scope.registerUser = function() {
           $http({
               method  : 'POST',
               //url     : 'http://killzombieswith.us/aii-api/v1/facilities',
               url     : '../aii-api/v1/users',
               data    : $scope.registration,  // pass in data as strings
               headers : { 'Content-Type': 'application/json' } 
           })
           .success(function(data) {
               //console.log(data.records["User Registration Response"]);
               alert(data.records["User Registration Response"]);
           });
           
           
       }
       
       
       
   }
   //Added by Travis. 
    /**
     * @function getData - 
     *  Helper function that accepts a URL API call and GET's an appropriate
     *  JSON response for that URL.
     *
     * @param: string $http - reference to URL API call
     * @returns {object} - 
     *      @function get - returns a value based on a key
     */
    userRegApp.factory('getData', function($http){

        return {
            get: function(url) { 
                var data = $http.get(url).success(function(data) {
                });
                return data;
            },
        }

    });
    userRegApp.directive("fileread", [function () {
        return {
            scope: {
                fileread: "="
            },
            link: function (scope, element, attributes) {
                element.bind("change", function (changeEvent) {
                    var reader = new FileReader();
                    reader.onload = function (loadEvent) {
                        scope.$apply(function () {
                            scope.fileread = loadEvent.target.result;
                        });
                    }
                    reader.readAsDataURL(changeEvent.target.files[0]);
                });
            }
        }
    }]);
   
   userRegApp.controller(controllers);
   
</script>