<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.2.min.js"></script>
    <script src="audiogram.kinetic.js"></script>  
    <style>

        .container{
            background-color: #7E7E7E
        }
        
        .mea-btn {
            background-color:#383D44;
            color:white;
        }
        
        
        .btn-selected{
            background-color:#1D72EF;
        }
      
    /*Audiograph action/menu buttons*/  
        .audiogram-menu{
            margin-bottom: 20px;
            margin-top:-20px;
            padding-left: 130px;
        }
        .btn-action{
            background-color:#383D44;
            color:white;
        }
        
        .btn-action:hover{
            color:#7E7E7E;
        }

        i.fa.pull-left{
            padding-top:3px;
        }
    /*Audiogram container styles*/            

        #audiogram_left {
            margin-left: -30px;
        }
    /*Measure buttons*/          
        .mea-btn {
          background-color: hsl(216, 9%, 21%) !important;
          background-repeat: repeat-x;
          filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#3a3e45", endColorstr="#30343a");
          background-image: -khtml-gradient(linear, left top, left bottom, from(#3a3e45), to(#30343a));
          background-image: -moz-linear-gradient(top, #3a3e45, #30343a);
          background-image: -ms-linear-gradient(top, #3a3e45, #30343a);
          background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #3a3e45), color-stop(100%, #30343a));
          background-image: -webkit-linear-gradient(top, #3a3e45, #30343a);
          background-image: -o-linear-gradient(top, #3a3e45, #30343a);
          background-image: linear-gradient(#3a3e45, #30343a);
          border-color: #30343a #30343a hsl(216, 9%, 20%);
          color: #fff !important;
          text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.06);
          -webkit-font-smoothing: antialiased;
        }
        
        #measure-buttons{
            padding-left: 40px;
            padding-top: 100px;
        }
        #measure-buttons label.btn.mea-btn{
            margin-top:5px;
            border-radius:5px;
        }
        #mask-button{
            margin-top:30px;
            border-radius:5px;
        }
        
        #mask-button a{
            color:white
        }
        
        #mask-button a:hover{
            text-decoration: none;
        }
    /*title row*/
        .title{
            text-align:center;
            padding:0px;
            margin-top:-10px;
            margin-bottom:-40px;
        }
    </style>
  </head>
  <body>
    <div class="container">
        <div class="row">
            <div class="col-xs-5 title">
                <h2>Right Ear</h2>
            </div>
            <div class="col-xs-2">
            </div>
            <div class="col-xs-5 title">            
                <h2>Left Ear</h2>
            </div>
        </div>
        <div class="row">
        <div class="col-xs-5"  id="left_column">
            <div id="audiogram_right"></div>
        </div>
        <div class="col-xs-2">
            <!-- Auditory measure buttons -->
            <div class="btn-group-vertical" data-toggle="buttons" id="measure-buttons">
                <label class="btn mea-btn active">
                <input type="radio" name="measure" id="AC" checked><span class="left" id="ACR"><i class="fa fa-circle-o"></i></span><span class="mid">AC</span><span class="right" id="ACL">&#10005;</span>
                </label>
                <label class="btn  mea-btn">
                <input type="radio" name="measure" id="BC"><span class="left" id="BCR"><i class="fa fa-chevron-left"></i></span><span class="mid">BC</span><span class="right" id="BCL"><i class="fa fa-chevron-right"></i></span>
                </label>
                <label class="btn mea-btn">
                <input type="radio" name="measure" id="MCL"><span class="left">M</span><span class="mid">MCL</span><span class="right">M</span>
                </label>
                <label class="btn mea-btn">
                <input type="radio" name="measure" id="UCL"><span class="left">m</span><span class="mid">UCL</span><span class="right">m</span>
                </label>
                <label class="btn mea-btn">
                <input type="radio" name="measure" id="SF"><span class="left">S</span><span class="mid">SF</span><span class="right">S</span>
                </label>
                <label class="btn mea-btn">
                <input type="radio" name="measure" id="SF-A"><span class="left">A</span><span class="mid">SF-A</span><span class="right">A</span>
                </label>
                
                <button type="button" class="btn mea-btn" id="mask-button">
                  <a href="#" >
                <i class="fa fa-ban pull-left"></i> Masked</a>
                </button>
                
            </div>
        </div><!-- End Button Column-->
        <div class="col-xs-5" id="right_column">
            <div id="audiogram_left"></div>
        </div>
        </div> <!-- End Row -->
        <div class="row">
            <div class="col-xs-5">
                <div class="audiogram-menu" data="right">
                    <button class="btn btn-xs btn-action" data="Undo" id="undo"><i class="fa fa-undo pull-left"></i>Undo</button>
                    <button class="btn btn-xs btn-action" data="Refresh" id="refresh"><i class="fa fa-refresh pull-left"></i>Clear</button>
                    <button class="btn btn-xs btn-action" data="Redo" id="redo"><i class="fa fa-repeat pull-left"></i>Redo</button>
                </div>
            </div>
            <div class="col-xs-2">
            </div>
            <div class="col-xs-5">            
                <div class="audiogram-menu" data="left">
                    <button class="btn btn-xs btn-action" data="Undo" id="undo"><i class="fa fa-undo pull-left"></i>Undo</button>
                    <button class="btn btn-xs btn-action" data="Refresh" id="refresh"><i class="fa fa-refresh pull-left"></i>Clear</button>
                    <button class="btn btn-xs btn-action" data="Redo" id="redo"><i class="fa fa-repeat pull-left"></i>Redo</button>
                </div>
            </div>
        </div>
    </div> <!-- End Container -->
    <script>
    $(function() {
        //combine stuff later        
        
        var stage_right = new Kinetic.Stage({
            container: 'audiogram_right',
            width: 500,
            height: 500
        });
        
        var stage_left = new Kinetic.Stage({
            container: 'audiogram_left',
            width: 500,
            height: 500
        });
        
        var Stage = {};
        
        Stage['right'] = new AudioGram(stage_right,100,'right');
        Stage['left'] = new AudioGram(stage_left,100,'left');
        
        /*
        * This function highlights the active measure button as well as
        * setting the proper character for each board according to the 
        * measure.
        */
        $( ".mea-btn" ).on( "click", function() {
            if($( this )[0].id == 'mask-button'){
                 if($(this).find($(".fa-ban")).length){
                    Stage['right'].setMasked(1);
                    Stage['left'].setMasked(1);
                    $(this).find($(".fa-ban")).removeClass('fa-ban').addClass('fa-check');
                    $('#BCL').html(']');
                    $('#BCR').html('[');        
                    $('#ACL').html('<i class="fa fa-square-o"></i>');
                    $('#ACR').html('&#x25b3;');
                }else{
                    Stage['right'].setMasked(0);
                    Stage['left'].setMasked(0);
                    $(this).find($(".fa-check")).removeClass('fa-check').addClass('fa-ban');  
                    $('#BCR').html('<i class="fa fa-chevron-left"></i>');
                    $('#BCL').html('<i class="fa fa-chevron-right"></i>');
                    $('#ACR').html('<i class="fa fa-circle-o"></i>');
                    $('#ACL').html('&#10005;');
                }                   
            }else{
                setTimeout( function (){
                    $( ".mea-btn" ).each(function( index ) {
                        if($( this ).hasClass( "active" )){
                            $( this ).addClass('btn-selected');
                        }else{
                            $( this ).removeClass('btn-selected');
                        }
                    })
                    setTimeout( function (){
                        $( ".mea-btn" ).each(function( index ) {
                            if($( this ).hasClass( "active" )){
                                Stage['right'].setCurrentMeasure($( this ).find('input').attr('id'));
                                Stage['left'].setCurrentMeasure($( this ).find('input').attr('id'));
                            }
                        });
                    }, 0 );
                }, 0 );
            }
        });
        

        /*
        * When clicking the mask button, toggle mask on and off. Also change the "icons" on each of the buttons.
        * Could be better written, but good for now.
        */
        $( "#mask_button" ).on( "click", function() {
            //Using the .length makes this a boolean operation
            //otherwise, it always returns true
            if($(this).find($(".fa-ban")).length){
                Stage['right'].setMasked(1);
                Stage['left'].setMasked(1);
                $(this).find($(".fa-ban")).removeClass('fa-ban').addClass('fa-check');
                $('#BCL').html(']');
                $('#BCR').html('[');        
                $('#ACL').html('<i class="fa fa-square-o"></i>');
                $('#ACR').html('&#x25b3;');
            }else{
                Stage['right'].setMasked(0);
                Stage['left'].setMasked(0);
                $(this).find($(".fa-check")).removeClass('fa-check').addClass('fa-ban');  
                $('#BCR').html('<i class="fa fa-chevron-left"></i>');
                $('#BCL').html('<i class="fa fa-chevron-right"></i>');
                $('#ACR').html('<i class="fa fa-circle-o"></i>');
                $('#ACL').html('&#10005;');
            }
        });
                

        $('.audiogram-menu').on('click', function(event) {
            console.log(Stage);
            var side = $( this ).attr('data');
            var action = $(event.target).closest('button').attr("data");
            var current = null;
            console.log(Stage[side]);
            switch(action){
                case 'Refresh': Stage[side].clear();
                                break;
                case 'Undo':    Stage[side].undo();
                                break;
                case 'Redo':    Stage[side].redo();
                                break;
            }
        });
        
    });
    </script>      
  </body>
</html>